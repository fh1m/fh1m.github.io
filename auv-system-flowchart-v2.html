<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUV System Flowchart V2 - Complete Dataflow Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a192f 0%, #112240 50%, #1a2332 100%);
            color: #e6f1ff;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 2000px;
            margin: 0 auto;
            background: linear-gradient(135deg, #0d1b2a 0%, #1b263b 100%);
            border-radius: 30px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            border: 2px solid #2a4a6f;
        }

        .header {
            background: linear-gradient(135deg, #0a1929 0%, #1e3a5f 50%, #2a5298 100%);
            padding: 40px;
            text-align: center;
            border-bottom: 3px solid #64b5f6;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(100,181,246,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .header h1 {
            font-size: 3em;
            color: #64b5f6;
            text-shadow: 0 0 20px rgba(100, 181, 246, 0.5);
            position: relative;
            z-index: 1;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.3em;
            color: #90caf9;
            position: relative;
            z-index: 1;
        }

        .download-section {
            background: linear-gradient(135deg, #1a2332 0%, #162032 100%);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #2a4a6f;
        }

        .download-btn {
            background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);
            color: white;
            padding: 12px 35px;
            font-size: 1.1em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(30, 136, 229, 0.4);
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .download-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(30, 136, 229, 0.6);
        }

        .main-flow {
            padding: 40px 20px;
            position: relative;
        }

        .flow-title {
            text-align: center;
            font-size: 2.5em;
            color: #64b5f6;
            margin-bottom: 40px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 0 0 20px rgba(100, 181, 246, 0.5);
        }

        .flow-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 30px;
            max-width: 1900px;
            margin: 0 auto;
            position: relative;
        }

        /* Data Flow Connections */
        .connection {
            position: absolute;
            background: linear-gradient(90deg, #64b5f6 0%, #42a5f5 100%);
            height: 3px;
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.6);
            z-index: 0;
        }

        .connection::before {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid #42a5f5;
            border-top: 5px solid transparent;
            border-bottom: 5px solid transparent;
        }

        .vertical-connection {
            position: absolute;
            background: linear-gradient(180deg, #64b5f6 0%, #42a5f5 100%);
            width: 3px;
            box-shadow: 0 0 10px rgba(100, 181, 246, 0.6);
            z-index: 0;
        }

        .vertical-connection::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-top: 10px solid #42a5f5;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
        }

        /* Flow Boxes */
        .flow-box {
            background: linear-gradient(135deg, #1a2a3a 0%, #243447 100%);
            border: 2px solid #2a4a6f;
            border-radius: 20px;
            padding: 20px;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            z-index: 1;
        }

        .flow-box:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: #64b5f6;
            box-shadow: 0 10px 40px rgba(100, 181, 246, 0.3);
        }

        .flow-box-header {
            background: linear-gradient(135deg, #1e3a5f 0%, #2a5298 100%);
            color: #64b5f6;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1em;
            text-align: center;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .flow-box-content {
            font-size: 0.85em;
            color: #b0c4de;
            line-height: 1.6;
        }

        .flow-box-content ul {
            list-style: none;
            padding: 0;
        }

        .flow-box-content li {
            padding: 5px 0;
            position: relative;
            padding-left: 20px;
        }

        .flow-box-content li::before {
            content: '‚ñ∏';
            position: absolute;
            left: 0;
            color: #64b5f6;
            font-weight: bold;
        }

        .layer-badge {
            position: absolute;
            top: -15px;
            right: 15px;
            background: linear-gradient(135deg, #f57c00 0%, #ff9800 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(245, 124, 0, 0.5);
        }

        .hz-badge {
            position: absolute;
            top: -15px;
            left: 15px;
            background: linear-gradient(135deg, #43a047 0%, #66bb6a 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.7em;
            font-weight: bold;
        }

        /* Layer-specific colors */
        .layer-1 { border-color: #ef5350; }
        .layer-1 .flow-box-header { background: linear-gradient(135deg, #c62828 0%, #d32f2f 100%); color: #ffcdd2; }
        
        .layer-2 { border-color: #ffa726; }
        .layer-2 .flow-box-header { background: linear-gradient(135deg, #e65100 0%, #f57c00 100%); color: #ffe0b2; }
        
        .layer-3 { border-color: #26a69a; }
        .layer-3 .flow-box-header { background: linear-gradient(135deg, #00695c 0%, #00796b 100%); color: #b2dfdb; }
        
        .layer-4 { border-color: #ab47bc; }
        .layer-4 .flow-box-header { background: linear-gradient(135deg, #6a1b9a 0%, #7b1fa2 100%); color: #e1bee7; }

        .fusion-layer {
            border-color: #42a5f5;
            border-width: 4px;
            background: linear-gradient(135deg, #1565c0 0%, #1976d2 50%, #1e88e5 100%);
        }

        .fusion-layer .flow-box-header {
            background: linear-gradient(135deg, #0d47a1 0%, #1565c0 100%);
            color: #e3f2fd;
            font-size: 1.3em;
        }

        .control-layer {
            border-color: #66bb6a;
            border-width: 3px;
        }

        .control-layer .flow-box-header {
            background: linear-gradient(135deg, #2e7d32 0%, #388e3c 100%);
            color: #c8e6c9;
        }

        .output-layer {
            border-color: #ffa726;
            border-width: 4px;
            background: linear-gradient(135deg, #e65100 0%, #f57c00 50%, #ff9800 100%);
        }

        .output-layer .flow-box-header {
            background: linear-gradient(135deg, #bf360c 0%, #d84315 100%);
            color: #ffccbc;
            font-size: 1.3em;
        }

        /* Special large boxes */
        .large-box {
            grid-column: span 2;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        /* Fusion Core Styles */
        .fusion-core {
            text-align: center;
            padding: 40px;
            border-radius: 25px;
            background: linear-gradient(135deg, #0d47a1 0%, #1565c0 50%, #1976d2 100%);
            border: 5px solid #42a5f5;
            box-shadow: 0 10px 50px rgba(33, 150, 243, 0.5);
            position: relative;
            margin: 40px 0;
        }

        .fusion-core::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, #42a5f5, #1e88e5, #1565c0, #0d47a1);
            border-radius: 25px;
            z-index: -1;
            filter: blur(20px);
            opacity: 0.5;
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }

        .fusion-title {
            font-size: 2.5em;
            color: #e3f2fd;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(227, 242, 253, 0.5);
        }

        .fusion-subtitle {
            font-size: 1.2em;
            color: #90caf9;
            margin-bottom: 30px;
        }

        .fusion-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .fusion-component {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #64b5f6;
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .fusion-component h4 {
            color: #e3f2fd;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .fusion-component ul {
            list-style: none;
            padding: 0;
        }

        .fusion-component li {
            padding: 5px 0;
            color: #b3e5fc;
            font-size: 0.9em;
        }

        /* Data Flow Indicators */
        .data-flow-indicator {
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            background: rgba(100, 181, 246, 0.1);
            border-left: 4px solid #64b5f6;
            border-right: 4px solid #64b5f6;
            border-radius: 10px;
        }

        .data-flow-indicator strong {
            color: #64b5f6;
            font-size: 1.1em;
        }

        /* Legend */
        .legend {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #1a2332 0%, #162032 100%);
            border: 2px solid #2a4a6f;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .legend h4 {
            color: #64b5f6;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            font-size: 0.85em;
        }

        .legend-color {
            width: 30px;
            height: 15px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: space-around;
            padding: 30px;
            background: linear-gradient(135deg, #1a2a3a 0%, #243447 100%);
            border-radius: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            flex: 1;
            min-width: 150px;
        }

        .stat-number {
            font-size: 2.5em;
            color: #64b5f6;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(100, 181, 246, 0.5);
        }

        .stat-label {
            color: #90caf9;
            font-size: 0.9em;
            margin-top: 5px;
        }

        /* Responsive Design */
        @media (max-width: 1600px) {
            .flow-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 1200px) {
            .flow-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .fusion-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .flow-grid {
                grid-template-columns: 1fr;
            }
            .fusion-grid {
                grid-template-columns: 1fr;
            }
            .legend {
                position: static;
                margin: 20px;
            }
        }

        /* Feedback Loop */
        .feedback-loop {
            text-align: center;
            padding: 30px;
            margin: 40px 0;
            background: linear-gradient(135deg, #ff6f00 0%, #ff8f00 50%, #ffa726 100%);
            border-radius: 20px;
            border: 3px solid #ff9800;
            box-shadow: 0 10px 30px rgba(255, 111, 0, 0.4);
        }

        .feedback-title {
            font-size: 2em;
            color: white;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .feedback-text {
            font-size: 1.2em;
            color: #fff3e0;
            line-height: 1.8;
        }

        .loop-rate {
            font-size: 1.5em;
            color: white;
            font-weight: bold;
            margin-top: 15px;
            padding: 10px 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 50px;
            display: inline-block;
        }

        /* Animated Flow Lines */
        @keyframes flowAnimation {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }

        .flow-box::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 20px;
            border: 2px solid transparent;
            animation: flowAnimation 3s ease-in-out infinite;
        }

        .flow-box:hover::after {
            border-color: #64b5f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° AUV SYSTEM ARCHITECTURE V2 ‚ö°</h1>
            <p>Complete Real-Time Dataflow: Sensors ‚Üí Perception ‚Üí FUSION ‚Üí Control ‚Üí Thrusters</p>
            <p style="font-size: 0.9em; margin-top: 10px; color: #64b5f6;">BracU Duburi | Multi-Layered Sensor Fusion at Core</p>
        </div>

        <div class="download-section">
            <button class="download-btn" onclick="downloadPage()">üì• Download Flowchart</button>
        </div>

        <div class="main-flow">
            <div class="flow-title">üîÑ Real-Time System Pipeline</div>

            <!-- LAYER 1: HARDWARE SENSORS -->
            <div class="flow-grid">
                <div class="flow-box layer-1">
                    <span class="layer-badge">LAYER 1</span>
                    <span class="hz-badge">100Hz</span>
                    <div class="flow-box-header">üéÆ Pixhawk 2.4.8</div>
                    <div class="flow-box-content">
                        <strong>Primary Flight Controller</strong>
                        <ul>
                            <li>Pitch angle (¬∞)</li>
                            <li>Yaw angle (¬∞)</li>
                            <li>Roll angle (¬∞)</li>
                            <li>MEMS IMU data</li>
                            <li>Magnetometer</li>
                            <li>Acceleration XYZ</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 5px; font-size: 0.8em;">
                            <strong>Output:</strong> Attitude quaternion, Angular velocity
                        </div>
                    </div>
                </div>

                <div class="flow-box layer-1">
                    <span class="layer-badge">LAYER 1</span>
                    <span class="hz-badge">50Hz</span>
                    <div class="flow-box-header">üìä BAR30 Barometer</div>
                    <div class="flow-box-content">
                        <strong>Depth Sensor</strong>
                        <ul>
                            <li>Pressure (mbar)</li>
                            <li>Depth (m)</li>
                            <li>Altitude</li>
                            <li>Temperature</li>
                            <li>1m calibration</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 5px; font-size: 0.8em;">
                            <strong>Output:</strong> Z-axis position (m)
                        </div>
                    </div>
                </div>

                <div class="flow-box layer-1">
                    <span class="layer-badge">LAYER 1</span>
                    <span class="hz-badge">10Hz</span>
                    <div class="flow-box-header">üåä DVL Nucleus1000</div>
                    <div class="flow-box-content">
                        <strong>Doppler Velocity Log</strong>
                        <ul>
                            <li>Velocity X (m/s)</li>
                            <li>Velocity Y (m/s)</li>
                            <li>Velocity Z (m/s)</li>
                            <li>Distance traveled</li>
                            <li>Altitude from bottom</li>
                            <li>1m X-Y calibration</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 5px; font-size: 0.8em;">
                            <strong>Output:</strong> Velocity vector, Dead reckoning
                        </div>
                    </div>
                </div>

                <div class="flow-box layer-1">
                    <span class="layer-badge">LAYER 1</span>
                    <span class="hz-badge">100Hz</span>
                    <div class="flow-box-header">üß≠ VectorNav/WitMotion</div>
                    <div class="flow-box-content">
                        <strong>Secondary IMU</strong>
                        <ul>
                            <li>Redundant attitude</li>
                            <li>Heading (¬∞)</li>
                            <li>Cross-validation</li>
                            <li>Gyro data</li>
                            <li>Accelerometer</li>
                            <li>Magnetometer backup</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 5px; font-size: 0.8em;">
                            <strong>Output:</strong> Fused heading, Reliability check
                        </div>
                    </div>
                </div>

                <div class="flow-box layer-1">
                    <span class="layer-badge">LAYER 1</span>
                    <span class="hz-badge">30Hz</span>
                    <div class="flow-box-header">üì∑ Blue Robotics Cameras</div>
                    <div class="flow-box-content">
                        <strong>Dual Camera System</strong>
                        <ul>
                            <li>Front camera (RGB)</li>
                            <li>Down camera (RGB)</li>
                            <li>Low-light optimized</li>
                            <li>Synchronized capture</li>
                            <li>1920x1080 @ 30FPS</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 5px; font-size: 0.8em;">
                            <strong>Output:</strong> Image frames (RGB)
                        </div>
                    </div>
                </div>
            </div>

            <div class="data-flow-indicator">
                <strong>‚¨áÔ∏è SENSOR DATA STREAMS TO PARALLEL PROCESSING LAYERS ‚¨áÔ∏è</strong>
            </div>

            <!-- PARALLEL PROCESSING LAYERS -->
            <div class="flow-grid">
                <!-- LAYER 2: VISION -->
                <div class="flow-box layer-2 large-box">
                    <span class="layer-badge">LAYER 2</span>
                    <span class="hz-badge">30Hz</span>
                    <div class="flow-box-header">üëÅÔ∏è Classical Computer Vision Stack</div>
                    <div class="flow-box-content">
                        <strong>Dual Camera Processing (Front + Down)</strong>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                            <div>
                                <strong style="color: #ffa726;">Visual Features:</strong>
                                <ul>
                                    <li>Hough Lines (edges)</li>
                                    <li>Contour detection</li>
                                    <li>SIFT features</li>
                                    <li>Optical Flow</li>
                                </ul>
                            </div>
                            <div>
                                <strong style="color: #ffa726;">Pose Estimation:</strong>
                                <ul>
                                    <li>Vanishing point</li>
                                    <li>Essential Matrix</li>
                                    <li>PnP (3D pose)</li>
                                    <li>Epipolar geometry</li>
                                </ul>
                            </div>
                        </div>
                        <div style="margin-top: 10px; padding: 10px; background: rgba(255,152,0,0.1); border-radius: 5px; border-left: 3px solid #ffa726;">
                            <strong>üéØ Purpose:</strong> Real-time attitude estimation independent of hardware sensors<br>
                            <strong>üì§ Output:</strong> CV-based Pitch/Yaw/Roll estimates + Confidence scores
                        </div>
                    </div>
                </div>

                <!-- LAYER 3: DEEP LEARNING -->
                <div class="flow-box layer-3 large-box">
                    <span class="layer-badge">LAYER 3</span>
                    <span class="hz-badge">30Hz GPU</span>
                    <div class="flow-box-header">ü§ñ Deep Learning Perception Stack</div>
                    <div class="flow-box-content">
                        <strong>Answer 4 Critical Questions:</strong>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                            <div style="background: rgba(38,166,154,0.1); padding: 10px; border-radius: 5px;">
                                <strong style="color: #4db6ac;">1Ô∏è‚É£ What can it see?</strong>
                                <ul>
                                    <li><strong>YOLOv12:</strong> Object detection</li>
                                    <li>Instance segmentation</li>
                                    <li>Bounding boxes</li>
                                    <li>Gate/Buoy/Bin ID</li>
                                </ul>
                            </div>
                            <div style="background: rgba(38,166,154,0.1); padding: 10px; border-radius: 5px;">
                                <strong style="color: #4db6ac;">2Ô∏è‚É£ How far?</strong>
                                <ul>
                                    <li><strong>Depth Anything V3</strong></li>
                                    <li>Monocular depth map</li>
                                    <li>DVL calibrated (1m)</li>
                                    <li>Object distance (m)</li>
                                </ul>
                            </div>
                            <div style="background: rgba(38,166,154,0.1); padding: 10px; border-radius: 5px;">
                                <strong style="color: #4db6ac;">3Ô∏è‚É£ Track what seen?</strong>
                                <ul>
                                    <li><strong>DINOv2:</strong> Tracking</li>
                                    <li>Feature extraction</li>
                                    <li>Scene understanding</li>
                                    <li>Pool feature map</li>
                                </ul>
                            </div>
                            <div style="background: rgba(38,166,154,0.1); padding: 10px; border-radius: 5px;">
                                <strong style="color: #4db6ac;">4Ô∏è‚É£ Seen before?</strong>
                                <ul>
                                    <li><strong>XFeat/SuperGlue</strong></li>
                                    <li>Feature matching</li>
                                    <li>Place recognition</li>
                                    <li>Loop closure</li>
                                </ul>
                            </div>
                        </div>
                        <div style="margin-top: 10px; padding: 10px; background: rgba(0,121,107,0.1); border-radius: 5px; border-left: 3px solid #26a69a;">
                            <strong>üì§ Output:</strong> Detected objects + Distances + Tracking IDs + Match confidence
                        </div>
                    </div>
                </div>

                <!-- LAYER 4: NAVIGATION -->
                <div class="flow-box layer-4">
                    <span class="layer-badge">LAYER 4</span>
                    <span class="hz-badge">1-10Hz</span>
                    <div class="flow-box-header">üó∫Ô∏è Navigation & Planning</div>
                    <div class="flow-box-content">
                        <strong>Mission Management</strong>
                        <ul>
                            <li><strong>High-Level Map:</strong> Task sequence</li>
                            <li><strong>3D Maps:</strong> Gaussian Splatting</li>
                            <li><strong>Path Planning:</strong> Trajectories</li>
                            <li><strong>Waypoints:</strong> X,Y,Z targets</li>
                            <li><strong>Task Manager:</strong> State machine</li>
                            <li><strong>Future:</strong> SLAM/VSLAM/VIO</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 10px; background: rgba(106,27,154,0.1); border-radius: 5px; border-left: 3px solid #ab47bc;">
                            <strong>üì§ Output:</strong> Target waypoint, Task commands, Path trajectory
                        </div>
                    </div>
                </div>
            </div>

            <div class="data-flow-indicator">
                <strong>‚¨áÔ∏è ALL STREAMS CONVERGE TO CENTRAL FUSION ENGINE ‚¨áÔ∏è</strong>
            </div>

            <!-- CENTRAL FUSION CORE -->
            <div class="fusion-core full-width">
                <div class="fusion-title">‚ö° CENTRAL FUSION ENGINE ‚ö°</div>
                <div class="fusion-subtitle">The Heart of the System - Multi-Layered Adaptive Sensor Fusion</div>
                
                <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 15px; margin-bottom: 30px;">
                    <strong style="font-size: 1.2em; color: #e3f2fd;">üéØ Fusion Philosophy:</strong>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 15px; font-size: 0.95em;">
                        <div>
                            <strong style="color: #ffcdd2;">üî¥ Hardware Sensors:</strong><br>
                            Highest trust (ground truth)<br>
                            Real metric values
                        </div>
                        <div>
                            <strong style="color: #ffe0b2;">üü† Vision Layers:</strong><br>
                            Real-time correction<br>
                            Anomaly detection
                        </div>
                        <div>
                            <strong style="color: #b2dfdb;">üü¢ Perception Layers:</strong><br>
                            Task awareness<br>
                            Spatial understanding
                        </div>
                    </div>
                </div>

                <div class="fusion-grid">
                    <div class="fusion-component">
                        <h4>üîó Multi-Sensor Fusion</h4>
                        <ul>
                            <li>Kalman filtering</li>
                            <li>Complementary filter</li>
                            <li>Weighted averaging</li>
                            <li>Outlier rejection</li>
                            <li>Sensor health check</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(0,0,0,0.2); border-radius: 5px; font-size: 0.85em;">
                            <strong>Rate:</strong> 100Hz
                        </div>
                    </div>

                    <div class="fusion-component">
                        <h4>üîÑ Vision-Hardware Fusion</h4>
                        <ul>
                            <li>CV vs Pixhawk compare</li>
                            <li>Mismatch detection</li>
                            <li>Magnetic interference flag</li>
                            <li>Vibration detection</li>
                            <li>Dynamic weight adjust</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(0,0,0,0.2); border-radius: 5px; font-size: 0.85em;">
                            <strong>Rate:</strong> 30Hz
                        </div>
                    </div>

                    <div class="fusion-component">
                        <h4>üß† Perception Integration</h4>
                        <ul>
                            <li>DL results merging</li>
                            <li>Object tracking fusion</li>
                            <li>Distance validation</li>
                            <li>Confidence scoring</li>
                            <li>Task state awareness</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(0,0,0,0.2); border-radius: 5px; font-size: 0.85em;">
                            <strong>Rate:</strong> 30Hz
                        </div>
                    </div>

                    <div class="fusion-component">
                        <h4>üéØ Navigation Fusion</h4>
                        <ul>
                            <li>Map-based localization</li>
                            <li>Waypoint tracking</li>
                            <li>Path following</li>
                            <li>Dead reckoning</li>
                            <li>Position estimation</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(0,0,0,0.2); border-radius: 5px; font-size: 0.85em;">
                            <strong>Rate:</strong> 10Hz
                        </div>
                    </div>
                </div>

                <div style="margin-top: 30px; padding: 25px; background: rgba(255,255,255,0.15); border-radius: 15px; border: 3px solid #90caf9;">
                    <div style="font-size: 1.3em; font-weight: bold; color: #e3f2fd; margin-bottom: 15px;">üì§ FUSION OUTPUT:</div>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; font-size: 1.05em;">
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                            <strong style="color: #4fc3f7;">Position</strong><br>
                            X, Y, Z (m)
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                            <strong style="color: #4fc3f7;">Attitude</strong><br>
                            Pitch, Yaw, Roll (¬∞)
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                            <strong style="color: #4fc3f7;">Velocity</strong><br>
                            Vx, Vy, Vz (m/s)
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px;">
                            <strong style="color: #4fc3f7;">Target Info</strong><br>
                            Object, Distance, Bearing
                        </div>
                    </div>
                </div>
            </div>

            <div class="data-flow-indicator">
                <strong>‚¨áÔ∏è FUSED STATE FEEDS TO PID CONTROLLERS ‚¨áÔ∏è</strong>
            </div>

            <!-- CONTROL LAYER -->
            <div class="flow-grid">
                <div class="flow-box control-layer">
                    <span class="layer-badge">CONTROL</span>
                    <span class="hz-badge">100Hz</span>
                    <div class="flow-box-header">üìê Depth Controller</div>
                    <div class="flow-box-content">
                        <strong>Z-Axis PID Control</strong>
                        <ul>
                            <li>Target depth (m)</li>
                            <li>Current depth (m)</li>
                            <li>PID computation</li>
                            <li>Vertical thrust output</li>
                            <li>Kp, Ki, Kd tuning</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(46,125,50,0.1); border-radius: 5px; font-size: 0.8em;">
                            <strong>Output:</strong> Vertical thruster commands
                        </div>
                    </div>
                </div>

                <div class="flow-box control-layer">
                    <span class="layer-badge">CONTROL</span>
                    <span class="hz-badge">100Hz</span>
                    <div class="flow-box-header">üéØ Attitude Controller</div>
                    <div class="flow-box-content">
                        <strong>Orientation PID Control</strong>
                        <ul>
                            <li>Pitch stabilization</li>
                            <li>Yaw heading control</li>
                            <li>Roll stabilization</li>
                            <li>Angular velocity damping</li>
                            <li>Multi-axis PID</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(46,125,50,0.1); border-radius: 5px; font-size: 0.8em;">
                            <strong>Output:</strong> Rotational thruster commands
                        </div>
                    </div>
                </div>

                <div class="flow-box control-layer">
                    <span class="layer-badge">CONTROL</span>
                    <span class="hz-badge">100Hz</span>
                    <div class="flow-box-header">üìç Position Controller</div>
                    <div class="flow-box-content">
                        <strong>X-Y Position PID</strong>
                        <ul>
                            <li>Waypoint navigation</li>
                            <li>Station keeping</li>
                            <li>X-Y position error</li>
                            <li>Velocity limiting</li>
                            <li>Trajectory following</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(46,125,50,0.1); border-radius: 5px; font-size: 0.8em;">
                            <strong>Output:</strong> Forward/Lateral thrust
                        </div>
                    </div>
                </div>

                <div class="flow-box control-layer">
                    <span class="layer-badge">CONTROL</span>
                    <span class="hz-badge">100Hz</span>
                    <div class="flow-box-header">‚ö° Velocity Controller</div>
                    <div class="flow-box-content">
                        <strong>Speed Control</strong>
                        <ul>
                            <li>Target velocity</li>
                            <li>Acceleration limits</li>
                            <li>Smooth transitions</li>
                            <li>Jerk minimization</li>
                            <li>Energy optimization</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(46,125,50,0.1); border-radius: 5px; font-size: 0.8em;">
                            <strong>Output:</strong> Velocity-based thrust
                        </div>
                    </div>
                </div>

                <div class="flow-box control-layer">
                    <span class="layer-badge">CONTROL</span>
                    <span class="hz-badge">Variable</span>
                    <div class="flow-box-header">üé¨ Task Action Controller</div>
                    <div class="flow-box-content">
                        <strong>Mission Actions</strong>
                        <ul>
                            <li>Marker drop trigger</li>
                            <li>Torpedo fire command</li>
                            <li>Manipulator control</li>
                            <li>Tool activation</li>
                            <li>Event-based actions</li>
                        </ul>
                        <div style="margin-top: 10px; padding: 8px; background: rgba(46,125,50,0.1); border-radius: 5px; font-size: 0.8em;">
                            <strong>Output:</strong> Digital I/O commands
                        </div>
                    </div>
                </div>
            </div>

            <div class="data-flow-indicator">
                <strong>‚¨áÔ∏è CONTROL SIGNALS TO THRUSTER MIXING & ALLOCATION ‚¨áÔ∏è</strong>
            </div>

            <!-- OUTPUT LAYER -->
            <div class="output-layer full-width" style="padding: 40px; border-radius: 25px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 2.5em; color: #ffccbc; font-weight: bold; text-shadow: 0 0 20px rgba(255, 204, 188, 0.5);">
                        üöÄ THRUSTER OUTPUT & PHYSICAL ACTUATION üöÄ
                    </div>
                    <div style="font-size: 1.2em; color: #ffe0b2; margin-top: 10px;">
                        400Hz PWM Signals ‚Üí 8 Thrusters + Task Actuators
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; border: 2px solid #ffab91;">
                        <h4 style="color: #ffccbc; margin-bottom: 10px; font-size: 1.2em;">‚¨ÜÔ∏è Forward Thrusters</h4>
                        <ul style="list-style: none; padding: 0; color: #ffe0b2;">
                            <li>‚úì Left Forward (PWM)</li>
                            <li>‚úì Right Forward (PWM)</li>
                            <li>‚úì Range: 1100-1900Œºs</li>
                            <li>‚úì Forward/Reverse motion</li>
                        </ul>
                    </div>

                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; border: 2px solid #ffab91;">
                        <h4 style="color: #ffccbc; margin-bottom: 10px; font-size: 1.2em;">‚ÜïÔ∏è Vertical Thrusters</h4>
                        <ul style="list-style: none; padding: 0; color: #ffe0b2;">
                            <li>‚úì Front Vertical (PWM)</li>
                            <li>‚úì Rear Vertical (PWM)</li>
                            <li>‚úì Depth control</li>
                            <li>‚úì Pitch stabilization</li>
                        </ul>
                    </div>

                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; border: 2px solid #ffab91;">
                        <h4 style="color: #ffccbc; margin-bottom: 10px; font-size: 1.2em;">‚ÜîÔ∏è Lateral Thrusters</h4>
                        <ul style="list-style: none; padding: 0; color: #ffe0b2;">
                            <li>‚úì Left Lateral (PWM)</li>
                            <li>‚úì Right Lateral (PWM)</li>
                            <li>‚úì Strafe motion</li>
                            <li>‚úì Yaw control</li>
                        </ul>
                    </div>

                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; border: 2px solid #ffab91;">
                        <h4 style="color: #ffccbc; margin-bottom: 10px; font-size: 1.2em;">üéØ Task Actuators</h4>
                        <ul style="list-style: none; padding: 0; color: #ffe0b2;">
                            <li>‚úì Marker Dropper</li>
                            <li>‚úì Torpedo Launcher</li>
                            <li>‚úì Manipulator Servo</li>
                            <li>‚úì Digital triggers</li>
                        </ul>
                    </div>
                </div>

                <div style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; text-align: center; border: 2px solid #ffab91;">
                    <strong style="font-size: 1.3em; color: #ffccbc;">‚öôÔ∏è RESULT:</strong>
                    <div style="font-size: 1.2em; color: #ffe0b2; margin-top: 10px;">
                        üåä Physical AUV Motion in 6DOF (Degrees of Freedom) üåä<br>
                        Translation: X, Y, Z | Rotation: Roll, Pitch, Yaw
                    </div>
                </div>
            </div>

            <!-- FEEDBACK LOOP -->
            <div class="feedback-loop">
                <div class="feedback-title">üîÑ CONTINUOUS FEEDBACK LOOP üîÑ</div>
                <div class="feedback-text">
                    AUV moves ‚Üí Sensors measure new state ‚Üí Vision observes changes ‚Üí<br>
                    Perception updates ‚Üí Fusion recalculates ‚Üí Control adjusts ‚Üí Thrusters respond ‚Üí <strong>REPEAT</strong>
                </div>
                <div class="loop-rate">‚ö° 100Hz Loop Rate (10ms cycle time) ‚ö°</div>
            </div>

            <!-- STATISTICS -->
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-number">4</div>
                    <div class="stat-label">Processing Layers</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">5</div>
                    <div class="stat-label">Hardware Sensors</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">7+</div>
                    <div class="stat-label">CV Algorithms</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">4</div>
                    <div class="stat-label">DL Models</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">5</div>
                    <div class="stat-label">PID Controllers</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">8</div>
                    <div class="stat-label">Thrusters</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">100Hz</div>
                    <div class="stat-label">Control Loop</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">‚àû</div>
                    <div class="stat-label">Robustness</div>
                </div>
            </div>

        </div>

        <!-- LEGEND -->
        <div class="legend">
            <h4>üé® LAYER LEGEND</h4>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #c62828 0%, #d32f2f 100%);"></div>
                <span>Layer 1: Hardware Sensors</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #e65100 0%, #f57c00 100%);"></div>
                <span>Layer 2: Vision Stack</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #00695c 0%, #00796b 100%);"></div>
                <span>Layer 3: Deep Learning</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #6a1b9a 0%, #7b1fa2 100%);"></div>
                <span>Layer 4: Navigation</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #1565c0 0%, #1976d2 100%);"></div>
                <span>Fusion Core</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #2e7d32 0%, #388e3c 100%);"></div>
                <span>Control Layer</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #e65100 0%, #f57c00 100%);"></div>
                <span>Output Layer</span>
            </div>
        </div>

        <!-- Footer -->
        <div style="text-align: center; padding: 40px; background: linear-gradient(135deg, #0a1929 0%, #1e3a5f 100%); border-top: 2px solid #2a4a6f;">
            <h3 style="color: #64b5f6; margin-bottom: 10px;">BracU Duburi AUV Team</h3>
            <p style="color: #90caf9;">Multi-Layered Sensor Fusion Architecture with Central Fusion at Core</p>
            <p style="color: #b0c4de; margin-top: 10px; font-size: 0.9em;">RoboSub Competition 2025 | System Architecture V2</p>
        </div>
    </div>

    <script>
        function downloadPage() {
            const content = document.querySelector('.container').cloneNode(true);
            
            // Remove download button
            const downloadSection = content.querySelector('.download-section');
            if (downloadSection) {
                downloadSection.remove();
            }

            // Remove legend (fixed position won't work in PDF)
            const legend = content.querySelector('.legend');
            if (legend) {
                legend.style.position = 'static';
                legend.style.marginTop = '20px';
            }

            const htmlContent = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AUV System Flowchart V2 - BracU Duburi</title>
    <style>
        ${document.querySelector('style').innerHTML}
        body { background: linear-gradient(135deg, #0a192f 0%, #112240 50%, #1a2332 100%); padding: 20px; }
        .container { box-shadow: none; }
        .legend { position: static; margin: 20px auto; max-width: 400px; }
        @media print {
            body { margin: 0; padding: 10px; background: white; }
            .flow-box { page-break-inside: avoid; }
            * { color-adjust: exact; -webkit-print-color-adjust: exact; }
        }
    </style>
</head>
<body>
    ${content.outerHTML}
</body>
</html>`;

            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'AUV_System_Flowchart_V2_BracU_Duburi.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // Success feedback
            const btn = document.querySelector('.download-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚úÖ Downloaded!';
            btn.style.background = 'linear-gradient(135deg, #43a047 0%, #66bb6a 100%)';
            
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = 'linear-gradient(135deg, #1e88e5 0%, #1565c0 100%)';
            }, 2000);
        }

        // Print functionality
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                window.print();
            }
        });

        // Add subtle animations on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.animation = 'fadeIn 0.5s ease-in-out';
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.flow-box').forEach(box => {
            observer.observe(box);
        });

        // Add fadeIn animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
